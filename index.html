<!doctype html>
<html ng-app>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/config.css">

    <script src="./angularjs/angular.min.js"></script>
    <script src="./controller/config.js"></script>

  </head>
<body>
  <!-- Adding the ng-app declaration to initialize AngularJS -->


      <!-- The navigation menu will get the value of the "active" variable as a class.
         The $event.preventDefault() stops the page from jumping when a link is clicked. -->



        <!-- When this element is clicked, hide the tooltip -->
        <!-- <div id="main" ng-app ng-controller="InlineEditorController" ng-click="hideTooltip()"> -->
        <div id="main" ng-app ng-controller="ConfigController" ng-click="hideTooltip()">
            <nav class="{{active}}" ng-click="$event.preventDefault()">

            <!-- When a link in the menu is clicked, we set the active variable -->

              <!-- <a href="#" class="home" ng-click="active='home'">Home</a> -->
              <a href="#" class="ios" ng-click="setPlatform(active='ios')">iOS</a>
              <a href="#" class="android" ng-click="setPlatform(active='android')">Android</a>
            </nav>

          <!-- ng-show will show an element if the value in the quotes is truthful,
             while ng-hide does the opposite. Because the active variable is not set
             initially, this will cause the first paragraph to be visible. -->
        <!--     <p ng-show="active">{{value}}:Platform {{active}}; App_Path {{appPath}}; New Command Timeout {{newCommandTimeout}}</p> -->


                <!-- This is the tooltip. It is shown only when the showtooltip variable is truthful -->
                <div class="tooltip" ng-click="$event.stopPropagation()" ng-show="showtooltip">
                    <div>
                        <label>Platform Name:</label>
                        <input type="text" ng-model="platformName" placeholder="android">
                    </div>
                    <div>
                        <label>App path:</label>
                        <input type="text" ng-model="appPath" placeholder="/Users/yi/Downloads/libon-android-client-3.0.1-qap-20140430.095235-20.apk" >
                    </div>
                    <div>
                        <label>Command Timeout:</label>
                        <input type="text" ng-model="newCommandTimeout" placeholder="999999">
                    </div>
                </div>

                <!-- Call a method defined in the InlineEditorController that toggles
                 the showtooltip variable -->
            <p ng-click="toggleTooltip($event)">{{value}}:Platform {{active}}; App_Path {{appPath}}; New Command Timeout {{newCommandTimeout}}</p>

        </div>




        <div id='dv1'>
            <form ng-controller="FrmController">

                <!-- <div>
                    <label>Platform Name</label>
                    <input type="text" ng-model="platformName" placeholder="android" style='margin-left: 22px;'>
                </div>
                <div>
                    <label>App path</label>
                    <input type="text" ng-model="appPath" placeholder="/Users/yi/Downloads/libon-android-client-3.0.1-qap-20140430.095235-20.apk" >
                </div>
                <div>
                    <label>Command Timeout</label>
                    <input type="text" ng-model="newCommandTimeout" placeholder="999999" style='margin-left: 22px;'>
                </div> -->
                <div>
                <button ng-click='createSession();' style='margin-left: 63px;margin-top:10px'>Create Session</button>
                <br>

                <button ng-click='getSession();' style='margin-left: 63px;margin-top:10px'>Get current Session</button>
                <br>
                <button ng-click='page();' style='margin-left: 63px;margin-top:10px'>Get current screen resource</button>
                <br>
                <button ng-click='screenshot();' style='margin-left: 63px;margin-top:10px'>Get screenshot</button>

                </div>
                <ul>
                    <li class="err" ng-repeat="error in errors"> {{ error}} </li>
                </ul>
                <ul>
                    <li class="info" ng-repeat="msg in msgs"> {{ msg }} </li>
                </ul>

                <img ng-src={{imageScr}}>


   <!--  <tr>

        <td><li class="info" ng-repeat="msg in msgs"> {{msg.type}} </li></td>
        <td><li class="info" ng-repeat="msg in msgs"> {{msg.children}} </li></td>
    </tr> -->

                <ul>
                    <li class="sid" ng-repeat="sid in sids"> {{ sid }} </li>
                </ul>
            </form>
        </div>

        <script type="text/javascript">
            function FrmController($scope, $http) {

                $scope.errors = [];
                $scope.msgs = [];
                $scope.sids = [];
                $scope.imageSource = '/tmp/current_screen.png';

                $scope.createSession = function() {

                    $scope.errors.splice(0, $scope.errors.length); // remove all error messages
                    $scope.msgs.splice(0, $scope.msgs.length);
                    $scope.sids.splice(0, $scope.sids.length);

                    $http.post('http://localhost:4736/wd/hub/session', {'desiredCapabilities': { 'platformName': $scope.platformName, 'app': $scope.appPath, 'newCommandTimeout': $scope.newCommandTimeout}}
                    ).success(function(data, status, headers, config) {
                        if (data.msg != '')
                        {
                            $scope.msgs.push(data);
                        }
                        else
                        {
                            $scope.errors.push(data.error);
                        }
                    }).error(function(data, status) { // called asynchronously if an error occurs
// or server returns response with an error status.
                        $scope.errors.push(status);
                    });
                }

                $scope.getSession = function() {

                    $scope.errors.splice(0, $scope.errors.length); // remove all error messages
                    $scope.msgs.splice(0, $scope.msgs.length);
                    $scope.sids.splice(0, $scope.sids.length);
                    $http.get('http://localhost:4736/wd/hub/session').success(function(data, status, headers, config) {


                        if (data.msg != '')
                        {
                            $scope.msgs.push("Response:", data);
                            $scope.sids.push("Session_id:", data.sessionId);
                        }
                        else
                        {
                            $scope.errors.push(data.error);
                        }
                    }).error(function(data, status) { // called asynchronously if an error occurs
// or server returns response with an error status.
                        $scope.errors.push(status);
                    });
                }

                $scope.page = function() {

                    $scope.errors.splice(0, $scope.errors.length); // remove all error messages
                    $scope.msgs.splice(0, $scope.msgs.length);
                    $scope.sids.splice(0, $scope.sids.length);

                      $http.get('http://localhost:4736/wd/hub/session').success(function(data){


                           $http.post('http://localhost:4736/wd/hub/session/'+data.sessionId+'/execute',{"script":"UIATarget.localTarget().frontMostApp().windows()[0].getTree()","args":""}).success(function(data, status, headers, config) {


                                if (data.msg != '')
                                {
                                    $scope.msgs.push(angular.fromJson(data.value));
                                }
                                else
                                {
                                    $scope.errors.push(data.error);
                                }
                            }).error(function(data, status) { // called asynchronously if an error occurs
        // or server returns response with an error status.
                                $scope.errors.push(status);
                            });

                });
            }

            $scope.screenshot = function() {

                    $scope.errors.splice(0, $scope.errors.length); // remove all error messages
                    $scope.msgs.splice(0, $scope.msgs.length);
                    $scope.sids.splice(0, $scope.sids.length);

                      $http.get('http://localhost:4736/wd/hub/session').success(function(data){
                           $http.get('http://localhost:4736/wd/hub/session/'+data.sessionId+'/screenshot').success(function(data, status, headers, config) {


                                if (data.msg != '')
                                {
                                    $scope.msgs.push(data);
                function fail(error) {
                    console.log(error.code);
                }
                function gotFileWriter(writer) {
                    writer.write(data.value);
                }
                function gotFileEntry(fileEntry) {
                    fileEntry.createWriter(gotFileWriter, fail);
                }
                function gotFS(fileSystem) {
                    fileSystem.root.getFile("current_screen.png", {create: true, exclusive: false}, gotFileEntry, fail);
                }
                function requestFS() {
                    window.PERSISTENT(window.PERSISTENT, 0, gotFS, fail);
                }
                /* write function OK */
                requestFS();


                                    // ('current_screen.png').src=data.value;
                                    $scope.imageScr='current_screen.png'
                                    // ('current_screen.png')= "data:image/png;base64,"+data.value;


                                }
                                else
                                {
                                    $scope.errors.push(data.error);
                                }
                            }).error(function(data, status) { // called asynchronously if an error occurs
        // or server returns response with an error status.
                                $scope.errors.push(status);
                            });
                      });
                      $scope.imageSourc = '/tmp/current_screen.png';
            }
        }
        </script>
        <!-- <a href='http://devzone.co.in'>Devzone.co.in</a> -->
</body>
</html>